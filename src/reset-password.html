<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password - University Timetable</title>
    <link rel="stylesheet" href="../styles/styles.css">
    <style>
        .reset-container {
            max-width: 500px;
            margin: 50px auto;
            padding: 30px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="logo-container">
        <img src="../logo.png" alt="University Logo">
    </div>
    
    <div class="title-container">
        <h1>University Timetable</h1>
        <div class="underline"></div>
    </div>
    
    <div class="reset-container">
        <h2>Reset Your Password</h2>
        <form id="resetForm">
            <div class="input-field">
                <span class="icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#999" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                    </svg>
                </span>
                <input type="password" id="newPassword" name="newPassword" placeholder="New Password" required>
            </div>
            
            <div class="input-field">
                <span class="icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#999" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                    </svg>
                </span>
                <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Confirm Password" required>
            </div>
            
            <button type="submit" class="auth-btn">Reset Password</button>
            
            <div class="form-footer">
                <a href="AdminLogin.html">Back to Login</a>
            </div>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const resetForm = document.getElementById('resetForm');
            const token = new URLSearchParams(window.location.search).get('token');
            
            if (!token) {
                alert('Invalid reset link. No token provided.');
                window.location.href = 'AdminLogin.html';
                return;
            }
            
            resetForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                
                if (newPassword !== confirmPassword) {
                    alert('Passwords do not match!');
                    return;
                }
                
                try {
                    // This endpoint would need to be added to the server
                    const response = await fetch('/api/reset-password', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ token, newPassword }),
                    });
                    
                    const data = await response.json();
                    
                    if (!response.ok) {
                        throw new Error(data.error || 'Password reset failed');
                    }
                    
                    alert('Password reset successful! You can now log in with your new password.');
                    window.location.href = 'AdminLogin.html';
                } catch (error) {
                    alert(error.message);
                }
            });
        });
    </script>
</body>
</html>